const toggleAttach = (e) => {
    // select the span with reliable identification like data-*
    const clipNode = document.querySelectorAll('.TbtXF')[e];
    // take its element, i.e. the button itself
    const clipButtonNode = clipNode.parentNode;
    // extract the current offset position relative to the document
    // more info here https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect
    // we can use this for filling in the non-0 screenX and screenY
    const clipButtonNodeClientRect = clipButtonNode.getBoundingClientRect();

    clipButtonNode.dispatchEvent(new MouseEvent("mousedown", {
        bubbles: true,
        cancelable: true,
        screenX: clipButtonNodeClientRect.x,
        screenY: clipButtonNodeClientRect.y
    }));
}

var start = 0;
var go = true;
var subs = [

];



setInterval(() => {


    document.querySelectorAll('.TbtXF').forEach((e, i) => {
        if ((e.innerHTML.includes('Ø±Ø³Ø§Ù„Ø© Ù¡ ØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡Ø©') || e.innerHTML.includes('Ø±Ø³Ø§Ù„ØªØ§Ù† Ù¢ ØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡ØªÙŠÙ†') || e.innerHTML.includes('Ø±Ø³Ø§Ø¦Ù„ ØºÙŠØ± Ù…Ù‚Ø±ÙˆØ¡Ø©')) && go) {
            toggleAttach(i)
            go = false;

        }
    });
    setTimeout(() => {
        var Messages = document.getElementsByClassName("GDTQm")
        var lastMessage = Messages[Messages.length - 1]

        go = true;




        if (!lastMessage.classList.contains('message-out')) {
            if (lastMessage.innerHTML.includes('ðŸŒ¹')) {
                var event = new InputEvent('input', { bubbles: true });

                var textbox = document.querySelector("#main > footer > div.vR1LG._3wXwX.copyable-area > div._2A8P4 > div > div._2_1wd.copyable-text.selectable-text")

                textbox.innerHTML = 'ðŸŒ¹ðŸŒ¹ðŸŒ¹';

                textbox.dispatchEvent(event);
                document.getElementsByClassName("_1E0Oz")[0].click();

            }



            if (lastMessage.innerHTML.includes('Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…')) {
                var event = new InputEvent('input', { bubbles: true });

                var textbox = document.querySelector("#main > footer > div.vR1LG._3wXwX.copyable-area > div._2A8P4 > div > div._2_1wd.copyable-text.selectable-text")

                textbox.innerHTML = 'ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡';

                textbox.dispatchEvent(event);
                docu
                document.getElementsByClassName("_1E0Oz")[0].click();
            }



            if (lastMessage.innerHTML.includes('Ø§Ø³Ù…ÙŠ:')) {
                sendername = document.querySelector("header div ._35k-1._1adfa._3-8er").innerText;
                var index = subs.findIndex(x => x.sender == sendername);
                console.log(index)
                console.log( lastMessage.innerHTML)
                console.log(index !== -1 )


                if (  index !== -1 ) {
                  var  name =  lastMessage.querySelector("._3-8er.selectable-text.copyable-text span").innerText.split(':');
                  subs[index].name = name[1];


                  var event = new InputEvent('input', { bubbles: true });
                  var textbox = document.querySelector("#main > footer > div.vR1LG._3wXwX.copyable-area > div._2A8P4 > div > div._2_1wd.copyable-text.selectable-text")
                  textbox.innerHTML = " Ø§Ø³Ù…Ùƒ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„ " + sendername + "Ø§Ø³Ù… Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù‡Ùˆ " + subs[index].name;
                  textbox.dispatchEvent(event);
                  document.getElementsByClassName("_1E0Oz")[0].click();
                }
                
            }




            if (lastMessage.innerHTML.includes('Ø§Ø´ØªØ±Ø§Ùƒ')) {

                var messageSend = 'ÙŠØ§ Ø§Ù‡Ù„Ø§ ÙˆØ³Ù‡Ù„Ø§'
                var event = new InputEvent('input', { bubbles: true });

                var textbox = document.querySelector("#main > footer > div.vR1LG._3wXwX.copyable-area > div._2A8P4 > div > div._2_1wd.copyable-text.selectable-text")


                var index = subs.findIndex(x => x.sender == document.querySelector("header div ._35k-1._1adfa._3-8er").innerText);
                // here you can check specific property for an object whether it exist in your array or not
                sendername = document.querySelector("header div ._35k-1._1adfa._3-8er").innerText;
                index === -1 ? subs[subs.length] = { sender: sendername, name: "" } : messageSend = 'Ø§Ù†Øª Ù…Ø³Ø¬Ù„ Ù…Ù† Ø§ÙˆÙ„ '

                var index = subs.findIndex(x => x.sender == document.querySelector("header div ._35k-1._1adfa._3-8er").innerText);




                textbox.innerHTML = messageSend;

                textbox.dispatchEvent(event);
                document.getElementsByClassName("_1E0Oz")[0].click();
                

                setTimeout(() => {
                    if (subs[index].name == "") {
                        textbox.innerHTML = `Ø§Ø±Ø³Ù„ Ø§Ø³Ù…Ùƒ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø·
                        https://api.whatsapp.com/send?phone=966564364261&text=%D8%A7%D8%B3%D9%85%D9%8A:`;

                        textbox.dispatchEvent(event);
                        document.getElementsByClassName("_1E0Oz")[0].click();
                    }
                }, 1000);


            }
            go = true;

        }


    }, 2000);

}, 6000);
